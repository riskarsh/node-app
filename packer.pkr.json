{
  "packer": {
    "required_plugins": {
      "amazon": {
        "version": ">= 1.2.8",
        "source": "github.com/hashicorp/amazon"
      }
    }
  },

  "variable": {
    "aws_region": {
      "type": "string",
      "default": "us-west-1"
    }
  },

  "source": {
    "amazon-ebs": {
      "ubuntu-node-app": {
        "region": "${var.aws_region}",
        "source_ami_filter": {
          "filters": {
            "name": "ubuntu/images/hvm-ssd-gp3/ubuntu-noble-24.04-amd64-server-*",
            "root-device-type": "ebs",
            "virtualization-type": "hvm"
          },
          "owners": ["099720109477"],
          "most_recent": true
        },
        "instance_type": "t3.micro",
        "ssh_username": "ubuntu",
        "ami_name": "node-app-ubuntu24-{{timestamp}}",

        "ami_regions": ["us-east-1", "us-east-2", "us-west-2"]
      }
    }
  },

  "build": {
    "sources": ["source.amazon-ebs.ubuntu-node-app"],

    "provisioner": [
      {
        "shell": {
          "inline": [
            "mkdir -p /tmp/app"
          ]
        }
      },
      {
        "file": {
          "source": "./",
          "destination": "/tmp/app"
        }
      },
      {
        "shell": {
          "script": "scripts/setup.sh"
        }
      }
    ]
  }
}
